# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要
**GBAゲーム「遊☆戯☆王デュエルモンスターズ エキスパート2006」専用のカード検索ツール**  
HTML/CSS/JavaScript（静的サイト）で作成されたWebアプリケーション  
ゲーム攻略のためにGoogle Spreadsheetで管理していた約2,000件のカードデータをCSVで読み込み、高速検索を実現

### ゲーム背景
- **対象ゲーム**: 遊☆戯☆王デュエルモンスターズ エキスパート2006（GBA、2006年発売）
- **目的**: ゲーム内でのデッキ構築・カード収集の効率化
- **データ範囲**: ゲームに収録されたカードのみを対象（約2,000枚）

### 技術スタック
- **フロントエンド**: HTML5, CSS3, vanilla JavaScript (ES6+)
- **データ形式**: CSV files
- **データ処理**: JavaScript (CSVパーサー)
- **検索機能**: リアルタイム検索、フィルタリング

## 開発・実行方法
- **開発環境**: Live Server拡張機能を使用してindex.htmlを開く
- **テスト**: ブラウザで動作確認（コンソールで「データ読み込み完了」メッセージを確認）
- **デバッグ**: ブラウザの開発者ツール（F12）でコンソールエラーを確認
- **動作確認**: 
  - カード検索機能: パック選択、種類フィルター、カード名検索
  - パック剥き機能: 1パック/5パック開封、アニメーション確認

## アーキテクチャ
### ファイル構成
```
yugioh-card-search/
├── data/
│   ├── card_master.csv    # ゲーム収録カードの基本情報（ID、種類、名前、パック情報）
│   ├── pack_master.csv    # ゲーム内パック情報（ID、パック名、出現内容）
│   └── query_results.csv  # 検索結果用（元SQLシート）
├── index.html             # メインページ
├── style.css             # スタイル
├── script.js             # 検索ロジック
├── javascript-learning-guide.md # script.js専用学習教材
├── README.md             # セットアップ手順、使用方法
└── CLAUDE.md             # このファイル
```

### データ構造
#### card_master.csv
```
#,種,カード名,パック
0001,1,13人目の埋葬者,"01,20,31,46"
0002,1,アクア・マドール,"01,29,46"
```
- **A列**: カードID（0001~）
- **B列**: 種類（1=通常モンスター、2=効果モンスター、3=融合モンスター、4=魔法、5=罠）
- **C列**: カード名
- **D列**: パック情報（カンマ区切り）

#### pack_master.csv
```
#,パック名,出現内容,手に入れやすさ
01,LEGEND OF BLUE EYES WHITE DRAGON,最初から出現,1
02,METAL RAIDERS,最初から出現,1
```
- **A列**: パックID（01~）
- **B列**: パック名
- **C列**: 出現内容
- **D列**: 手に入れやすさ

### 検索システム
アプリは元のGoogle Spreadsheet QUERY関数を完全再現：
```
=QUERY(card!A:D,"select * where B matches '"&JOIN("|",2,3,4,5)&"' and D contains '"&TO_TEXT(B2)&"' order by B,A")
```

3つの主要なフィルタリング機能：
1. **パック選択**: pack_master.csvからプルダウン生成、選択されたパックIDでカードをフィルタリング
2. **種類フィルター**: 5つのチェックボックス（通常モンスター、効果モンスター、融合モンスター、魔法、罠）
3. **カード名検索**: リアルタイム部分一致検索

### CSVパーサー
カスタムCSVパーサーがダブルクォートで囲まれたデータを処理：
- `parseCSV()`: card_master.csv用
- `parsePackCSV()`: pack_master.csv用
- `parseCSVLine()`: ダブルクォート考慮の行パーサー

### データフロー
1. `loadData()`: 初期化時に両CSVファイルを読み込み
2. `performSearch()`: フィルター条件に基づいて検索実行
3. `displayResults()`: デスクトップ用テーブルとモバイル用カード表示の両方を更新
4. `showReverseLookup()`: カード名クリック時の逆引き機能
5. `openPack(packCount)`: パック剥き機能（1パック/5パック対応）
6. `showTab(tabName)`: タブ切り替え機能

### タブ構造
- **検索タブ**: 従来のカード検索機能
- **パック剥きタブ**: パック開封シミュレーション機能
- タブ切り替えはJavaScriptで制御、CSSでコンテンツ表示切り替え

### レスポンシブ対応
- **768px以上**: テーブル表示（.desktop-only）
- **768px未満**: カード型表示（.mobile-only）
- CSS Grid で自動レイアウト調整

## 重要な実装詳細
### 種類マッピング
```javascript
1: '通常モンスター'
2: '効果モンスター'
3: '融合モンスター'
4: '魔法'
5: '罠'
```

### パックIDの処理
- CSVデータ内のパック情報は「"01,20,31,46"」形式
- 検索時は2桁ゼロパディング（`padStart(2, '0')`）で比較

### 逆引き機能
カード名をクリックすると、そのカードが収録されているパック一覧を表示するモーダルが開く

### パック剥き機能
- **UI**: 2つのボタン（1パック開封/5パック開封）でパック数を直接選択
- **抽選**: 全カード同一確率、重複なしで5枚×パック数を抽選
- **表示**: 
  - 1パック: 単一パック形式でカード5枚を表示
  - 5パック: パック別にグループ化して25枚を表示
- **アニメーション**: 段階的にカード表示（タイミング調整済み）
- **レアリティ**: 設定なし（実際のゲームとは異なる）

## データ更新方法
静的サイトのため、データ更新は手動でCSVファイルを置き換え。data/フォルダ内の該当ファイルを更新後、ブラウザリロードで反映。

## 学習目標と技術的工夫
### 学習目標
- CSV データの JavaScript での処理方法
- リアルタイム検索の実装
- 配列操作とフィルタリング
- DOM操作による動的UI更新
- 複数データソースの連携処理
- ゲーム攻略ツールとしての実用性向上

### 技術的な工夫点
- データ全体をメモリに読み込み、高速検索を実現
- 正規表現を使った柔軟な検索
- 元のGoogle Spreadsheet QUERY関数の動作を完全再現
- パフォーマンスを考慮したデータ構造設計
- ゲーム攻略に特化したUI/UX設計

## 現在の機能状況
### 完了済み機能
- ✅ カード検索機能（パック選択、種類フィルター、カード名検索）
- ✅ 逆引き機能（カード→パック情報）
- ✅ パック剥き機能（1パック/5パック対応）
- ✅ タブ切り替えUI
- ✅ レスポンシブデザイン
- ✅ データ読み込み・CSV解析
- ✅ README.md、学習ガイド作成


## 開発時の注意事項
- このプロジェクトは学習目的かつゲーム攻略支援ツール
- 現在は静的サイト（HTML/CSS/JavaScript）として完成済み
- データ更新はCSVファイルの手動置換
- ブラウザの互換性に配慮（ES6+対応ブラウザ）
- 約2,000件のゲームデータを一度に処理するため、メモリ使用量に注意
- このツールはゲーム「遊☆戯☆王デュエルモンスターズ エキスパート2006」専用
- パック剥き機能はレアリティ設定なしのおまけ機能